# Домашка урока 1 по курсу "Коммуникации систем"

## EventStorming

### Шаг 1: Расставить события и акторов

Здесь будет всего 2 актора: менеджеры и кандидаты в учителя. Собираем внешние системы из требований:
- система обучения сотрудников, куда добавляются учителя, успешно выполнившие задания [US-090]
- сторонний сервис найма, куда отправляются созданные и отредактированные задания [US-040]
- scheduler, который сообщает (раз в месяц) о том, что пора выплачивать бонусы менеджерам [US-150]
- сервис выплаты средств, зачисляющий финансы на счет менеджерам [US-150].

А также события.

Создание заданий для будущих учителей и управление ими:
- задание создано [US-010]
- задание изменено [US-020]
- назначен менеджер на переделку [US-030]
- задание добавлено в сторонний сервис найма [US-040]

Найм учителей:
- кандидат зарегистрировался [US-050]
- кандидат вошел в систему [US-060]
- задание назначено кандидату [US-070]
- решение отправлено на проверку [US-080]
- задание выполнено неверно [US-080]
- задание выполнено успешно [US-080]
- учитель добавлен в систему обучения сотрудников [US-090]

Расчёт бонусов менеджеров:
- бонусы начислены [US-110]
- бонсусы списаны [US-130]
- настало время выплаты [US-150]
- выплата произошла [US-150]
- баланс обнулен [US-151]

Для требований [US-100], [US-120], [US-140] не добавлял событий, т.к. это скорее реализация, чем поведение.

[EventStorming1.pdf](./EventStorming1.pdf)

### Шаг 2: Добавляем команды, полиси и рид-модели

Добавляем команды.

Создание заданий для будущих учителей и управление ими:
- менеджер создает задание [US-010]
- менеджер изменяет задание [US-020]
- система назначает менеджера на переделку [US-030]
- система отправляет созданное/измененное задание в сторонний сервис [US-040]

Найм учителей:
- кандидат в учителя регистрируется в системе [US-050]
- кандидат входит в систему [US-060]
- менеджер назначает задание на кандидата [US-070]
- кандидат отправляет решение [US-080]
- система проверяет решение [US-080]
- система добавляет учителя в систему обучения сотрудников [US-090]

Расчёт бонусов менеджеров:
- система начисляет бонусы менеджеру [US-110] (тут дополнительно добавил коммент с деталями реализации - событие выполненного задания будет содержать актуальный рейтинг)
- система списывает бонусы менеджеру [US-130]
- система выплачивает средства менеджеру [US-150]
- система обнуляет баланс менеджера [US-151]

Полиси:
- задание сделано 10 раз подряд (условие для назначения задания на переделку) [US-030]
- баланс положительный (условие для начисления средств и обнуления баланса) [US-152]

И рид-модели:
- задание для изменения [US-020]
- список заданий для назначения кандидатам [US-070]
- задание для кандидата [US-071]

[EventStorming2.pdf](./EventStorming2.pdf)

### Шаг 3: Разбиваем систему на элементы, группируем команды по системе

Разбил согласно границам, которые уже установлены в требованиях.

[EventStorming.pdf](./EventStorming.pdf)

## Опишите, как после этого изменятся связи. Какие из проблем бизнеса решатся (из описанных в списке выше) и почему вы решили изменить существующую связь.

Номер связи | Как связь сделана на текущий момент | Какая теперь будет связь | Номера проблем бизнеса, которые потенциально решатся | Почему связь небходимо изменить
-- | -- | -- | -- | --
[COMM-030] | HTTP-вызов из сервиса найма в сервис менеджмента | Отправка события `TaskTooEasy` | [Problem-010], [Problem-070] | Отказ в сервисе менеджмента не приведет к ошибкам при выполнении заданий, а также уменьшит задержку на ожидание ответа. Избежим повторной отправки задания, если сервис менеджмента упал. Здесь хотелось бы перенести проверку на "легкость" задания в сервис менеджмента (как и указано в границах требований), но границы сервисов изменять мы не можем.
[COMM-040] | HTTP-вызов из сервиса найма в сервис бонусов | Отправка события `TaskCompleted` | [Problem-010], [Problem-040], [Problem-080] | Уменьшает coupling между сервисом найма и сервисом бонусов. Отказ в сервисе бонусов не приведет к ошибкам при выполнении заданий. Уменьшит задержку, т.к. теперь не ждем ответа от сервиса бонусов.
[COMM-050] | HTTP-вызов из сервиса найма в сервис бонусов | Отправка события `TaskFailed` | [Problem-010], [Problem-040], [Problem-080] | Аналогично причинам в [COMM-040]
[COMM-060] | Отправка события `TaskRating` | Убираем связь, актуальный рейтинг будет в событии `TaskCompleted` | [Problem-030] | Избавляемся от задержки изменения рейтинга во время начисления бонусов. Событие не будет слишком coarse, т.к. рейтинг - часть информации о выполненном задании
[COMM-080] | HTTP-вызов из сервиса менеджмента в сервис бонусов | Отправка события `TaskCreated` | [Problem-090] | Уменьшает coupling между сервисом менеджмента и сервисом бонусов. Сервис менеджмента не должен знать о бонусах за созданные задания.