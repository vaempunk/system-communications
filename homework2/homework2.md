# Домашка урока 2 по курсу "Коммуникации систем"

## Концептуальная модель данных

[concept-data-model.pdf](./concept-data-model.pdf)

## Общая модель связей

Референс на EventStorming: [EventStorming.pdf](./EventStorming.pdf)

[communication-model.pdf](./communication-model.pdf)

## Найдите места, в которых нужно поменять связи с синхронных на асинхронные

- [COMM-030] Назначение менеджера на переделку задания
- [COMM-040] Зачисление бонусов на счёт менеджера
- [COMM-050] Списание средств со счёта менеджера
- [COMM-070] Получение информации о менеджере
- [COMM-080] Зачисление средств на счёт менеджера
- [COMM-090] Получение списка кандидатов в учителя, которым будут назначаться задачи

## Опишите, как после этого изменятся связи. Какие из проблем бизнеса решатся и почему вы решили изменить существующую связь

Номер связи | Как связь сделана на текущий момент | Какая теперь будет связь | Номера проблем бизнеса, которые потенциально решатся | Почему связь небходимо изменить
-- | -- | -- | -- | --
[COMM-010] | HTTP-вызов из сервиса найма в сервис менеджмента | Убираем связь, судя по карте коммуникаций она лишняя | [Problem-060] | Отказ в сервисе менеджмента не приведет к ошибкам в сервисе найма, при просмотре задания кандидатом. Также снижается нагрузка на сервис менеджмента
[COMM-030] | HTTP-вызов из сервиса найма в сервис менеджмента | Отправка события `TaskTooEasy` | [Problem-010], [Problem-070] | Отказ в сервисе менеджмента не приведет к ошибкам при выполнении заданий, а также уменьшит задержку на ожидание ответа. Избежим повторной отправки задания, если сервис менеджмента упал. Здесь хотелось бы перенести проверку на "легкость" задания в сервис менеджмента (как и указано в границах требований), но границы сервисов изменять мы не можем.
[COMM-040] | HTTP-вызов из сервиса найма в сервис бонусов | Отправка события `TaskCompleted` | [Problem-010], [Problem-040], [Problem-080] | Уменьшает coupling между сервисом найма и сервисом бонусов. Отказ в сервисе бонусов не приведет к ошибкам при выполнении заданий. Уменьшит задержку, т.к. теперь не ждем ответа от сервиса бонусов.
[COMM-050] | HTTP-вызов из сервиса найма в сервис бонусов | Отправка события `TaskFailed` | [Problem-010], [Problem-040], [Problem-080] | Аналогично причинам в [COMM-040]
[COMM-060] | Отправка события `TaskRating` | Убираем связь, актуальный рейтинг будет в событии `TaskCompleted` | [Problem-030] | Избавляемся от задержки изменения рейтинга во время начисления бонусов. Событие не будет слишком coarse, т.к. рейтинг - часть информации о выполненном задании
[COMM-070] | HTTP-вызов из сервиса бонусов в сервис менеджмента | Отправка события `ManagerCreated` | [Problem-060] | Репликация данных о менеджерах снизит нагрузку на сервис менеджмента при выплате бонусов
[COMM-080] | HTTP-вызов из сервиса менеджмента в сервис бонусов | Отправка события `TaskCreated` | [Problem-090] | Уменьшает coupling между сервисом менеджмента и сервисом бонусов. Сервис менеджмента не должен знать о бонусах за созданные задания.
[COMM-090] | HTTP-вызов из сервиса менеджмента в сервис найма | Отправка события `CandidateRegistered` | [Problem-060] | Репликация данных о кандидатах в учителя снизит нагрузку на сервис менеджмента, так как мы избавимся от лишнего блокирующего вызова при назначении заданий

## Напишите название всех топиков и события, которые будут в топиках

Название очереди/топика | Названия событий и номеров связи, которые окажутся в топике | Почему вы поместили в топик именно эти события | Почему так назвали
-- | -- | -- | --
domain.task_improvement.task_too_easy | Событие `TaskTooEasy` ([COMM-030]) | Событие будет намного реже, чем результат выполнения, поэтому выделил для него отдельный топик | bounded context - улучшение заданий, топик содержит только один тип событий
domain.task_completion | События `TaskCompleted` ([COMM-040]), `TaskFailed` ([COMM-050]) | Ожидаем, что задание достаточно сложные, чтобы результаты отправлялись примерно в равной степени | bounded context - завершение заданий, топик содержит два разных события
data_replication.managers.created | Событие `ManagerCreated` ([COMM-070]) | Реплицируем менеджеров в сервис бонусов  | Сущность в формальной связи - менеджеры
data_replication.tasks.created | Событие `TaskCreated` ([COMM-080]) | Сервису бонусов нужны только события создания заданий. Сервис найма консюмером не будет, т.к. он продолжит синхронно получать задания (из-за требований к строгой консистентности в [Problem-020]) | Хотя на карте коммуникаций в нем будут бизнесовые события, мне кажется его можно считать топиком репликации. Сущность в формальной связи - задания
data_replication.candidates.created | Событие `CandidateRegistered` ([COMM-090]) | Реплицируем кандидатов в учителя в сервис менеджмента | Сущность в формальной связи - кандидаты в учителя